<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ðŸ’Ž GambiaBiz Ledger - Smart Financial Assistant</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'><rect width='64' height='64' rx='12' fill='%23d4af37'/><text x='32' y='42' text-anchor='middle' font-size='28' fill='white'>G</text></svg>">
<style>
/* ---------- Reset & base ---------- */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:Inter,system-ui,'Segoe UI',Roboto,Arial,sans-serif;background:linear-gradient(180deg,#f6f7fb 0%,#e8e9ee 100%);color:#111;line-height:1.45;padding:24px}

/* ---------- Container ---------- */
.container{max-width:980px;margin:0 auto;background:#fff;border-radius:16px;padding:26px;box-shadow:0 10px 30px rgba(0,0,0,0.08)}

/* ---------- Header ---------- */
header{text-align:center;margin-bottom:18px}
header h1{font-size:1.9rem;color:#1b5e20;letter-spacing:0.2px}
header p{color:#555;margin-top:6px}

/* ---------- Tabs ---------- */
.tabs{display:flex;gap:8px;border-bottom:1px solid #e6e6e6;margin-bottom:18px}
.tab-btn{flex:1;padding:10px 12px;background:transparent;border:0;cursor:pointer;font-weight:600;color:#444;border-bottom:3px solid transparent;transition:all .18s}
.tab-btn:hover{color:#000}
.tab-btn.active{color:#000;border-bottom-color:rgba(212,175,55,0.95);}

/* ---------- Cards ---------- */
.summary-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:20px}
.card{background:linear-gradient(180deg,#fff,#fbfbfb);padding:14px;border-radius:12px;border:1px solid rgba(0,0,0,0.03);box-shadow:0 6px 18px rgba(212,175,55,0.05);text-align:center}
.card h3{font-size:0.92rem;color:#666;margin-bottom:8px}
.amount{font-size:1.25rem;font-weight:700}
.amount.positive{color:#1b8e3b}
.amount.negative{color:#c82333}

/* ---------- Buttons ---------- */
.btn{display:inline-block;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn-primary{background:linear-gradient(90deg,#ffd700,#d4af37);color:#111;box-shadow:0 6px 18px rgba(212,175,55,0.12)}
.btn-secondary{background:linear-gradient(90deg,#cfcfcf,#a9a9a9);color:#fff}
.quick-actions{display:flex;gap:12px;margin-bottom:18px}

/* ---------- Lists / Transactions ---------- */
.transaction-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;margin-bottom:10px;background:linear-gradient(180deg,#fff,#fbfbfb);border-left:4px solid rgba(212,175,55,0.85);box-shadow:0 4px 12px rgba(0,0,0,0.03)}
.transaction-desc{flex:1;margin:0 12px;color:#333}
.transaction-date{font-size:0.85rem;color:#666}

/* ---------- Forms & Inputs ---------- */
input[type="text"],input[type="number"],input[type="date"],select{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-bottom:10px;font-size:0.95rem}
.form-actions{display:flex;gap:10px;margin-top:8px}

/* ---------- Modal ---------- */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;padding:18px;z-index:2000}
.modal.open{display:flex}
.modal-card{background:#fff;padding:18px;border-radius:12px;width:100%;max-width:520px;box-shadow:0 20px 40px rgba(0,0,0,0.2);position:relative}
.modal-close{position:absolute;right:12px;top:10px;border:0;background:transparent;font-size:20px;cursor:pointer;color:#666}

/* ---------- Notification ---------- */
.notification{position:fixed;right:18px;bottom:18px;padding:12px 16px;border-radius:10px;background:linear-gradient(90deg,#ffd700,#d4af37);color:#111;display:none;box-shadow:0 8px 24px rgba(212,175,55,0.14)}

/* ---------- AI Summary & Charts ---------- */
.ai-summary{background:#fbfdff;padding:14px;border-left:4px solid rgba(212,175,55,0.95);border-radius:10px;margin-top:12px}
.charts{background:#fff;padding:14px;border-radius:12px;margin-top:12px;box-shadow:0 6px 20px rgba(0,0,0,0.04)}

/* ---------- Responsive ---------- */
@media (max-width:640px){
  .quick-actions{flex-direction:column}
  .tabs{flex-direction:row;overflow:auto}
}
</style>
</head>
<body>

<div class="container" id="appContainer">
  <header>
    <h1>ðŸ’Ž GambiaBiz Ledger</h1>
    <p>Smart Financial Assistant for MSMEs</p>
  </header>

  <nav class="tabs" role="tablist">
    <button class="tab-btn active" data-tab="dashboard" aria-controls="dashboard">Dashboard</button>
    <button class="tab-btn" data-tab="transactions" aria-controls="transactions">Transactions</button>
    <button class="tab-btn" data-tab="invoices" aria-controls="invoices">Invoices</button>
    <button class="tab-btn" data-tab="reports" aria-controls="reports">Reports</button>
  </nav>

  <!-- Dashboard -->
  <section id="dashboard" class="tab-panel" aria-hidden="false">
    <div class="summary-cards">
      <div class="card"><h3>Total Balance</h3><p id="totalBalance" class="amount">GMD 0.00</p></div>
      <div class="card"><h3>This Month</h3><p id="monthlyIncome" class="amount positive">GMD 0.00</p></div>
      <div class="card"><h3>Expenses</h3><p id="monthlyExpenses" class="amount negative">GMD 0.00</p></div>
    </div>

    <div class="quick-actions">
      <button id="addTxBtn" class="btn btn-primary">âž• Add Transaction</button>
      <button id="createInvBtn" class="btn btn-secondary">ðŸ§¾ Create Invoice</button>
    </div>

    <div>
      <h3>Recent Activity</h3>
      <div id="recentTransactions" aria-live="polite"></div>
    </div>
  </section>

  <!-- Transactions -->
  <section id="transactions" class="tab-panel" aria-hidden="true" style="display:none;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <h2>All Transactions</h2>
      <button id="addTxBtn2" class="btn btn-primary">Add</button>
    </div>

    <div style="display:flex;gap:10px;margin-bottom:12px;">
      <select id="typeFilter" aria-label="Filter by type">
        <option value="all">All</option>
        <option value="sale">Sales</option>
        <option value="expense">Expenses</option>
      </select>
      <input id="dateFilter" type="date" aria-label="Filter by date">
    </div>

    <div id="allTransactions"></div>
  </section>

  <!-- Invoices -->
  <section id="invoices" class="tab-panel" aria-hidden="true" style="display:none;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <h2>Invoices</h2>
      <button id="createInvBtn2" class="btn btn-primary">Create</button>
    </div>
    <div id="invoicesList"></div>
  </section>

  <!-- Reports -->
  <section id="reports" class="tab-panel" aria-hidden="true" style="display:none;">
    <h2>Financial Reports</h2>
    <div style="display:flex;gap:10px;margin:12px 0;">
      <button id="aiSummaryBtn" class="btn btn-secondary">ðŸ“Š AI Summary</button>
      <button id="exportBtn" class="btn btn-secondary">ðŸ“¤ Export</button>
    </div>

    <div id="aiSummary" class="ai-summary" aria-live="polite"></div>
    <div class="charts">
      <canvas id="financeChart" width="800" height="300" aria-label="Financial chart"></canvas>
    </div>
  </section>
</div>

<!-- Transaction Modal -->
<div id="transactionModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card" role="document">
    <button class="modal-close" data-close>&times;</button>
    <h3>Add Transaction</h3>
    <form id="transactionForm">
      <label for="transactionType" class="sr-only">Type</label>
      <select id="transactionType" required>
        <option value="">Select Type</option>
        <option value="sale">Sale</option>
        <option value="expense">Expense</option>
      </select>

      <input id="amount" type="number" step="0.01" placeholder="Amount (GMD)" required />
      <input id="description" type="text" placeholder="Description" required />
      <input id="transactionDate" type="date" required />

      <div class="form-actions">
        <button type="button" class="btn" data-close>Cancel</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Invoice Modal -->
<div id="invoiceModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card">
    <button class="modal-close" data-close>&times;</button>
    <h3>Create Invoice</h3>
    <form id="invoiceForm">
      <input id="customerName" type="text" placeholder="Customer Name" required />
      <input id="customerPhone" type="text" placeholder="Customer Phone" />

      <div id="invoiceItems">
        <div class="invoice-item" style="display:flex;gap:8px;margin-bottom:8px;">
          <input type="text" class="item-desc" placeholder="Item description" required style="flex:2" />
          <input type="number" class="item-qty" placeholder="Qty" min="1" required style="flex:1" />
          <input type="number" class="item-price" placeholder="Price" step="0.01" required style="flex:1" />
        </div>
      </div>

      <div style="margin-bottom:10px;">
        <button id="addInvoiceItemBtn" type="button" class="btn">âž• Add Item</button>
      </div>

      <div class="form-actions">
        <button type="button" class="btn" data-close>Cancel</button>
        <button type="submit" class="btn btn-primary">Generate</button>
      </div>
    </form>
  </div>
</div>

<div id="notification" class="notification" role="status" aria-live="polite"></div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
/* ========= Utility ========= */
function el(id){ return document.getElementById(id); }
function qs(selector, root = document){ return root.querySelector(selector); }
function qsa(selector, root = document){ return Array.from(root.querySelectorAll(selector)); }
function hide(elem){ if(!elem) return; elem.style.display = 'none'; elem.setAttribute('aria-hidden','true'); }
function show(elem, display='block'){ if(!elem) return; elem.style.display = display; elem.setAttribute('aria-hidden','false'); }

/* ========= App Data & Persistence ========= */
const STORAGE_KEYS = { TX:'gambiabiz_transactions', INV:'gambiabiz_invoices' };
function load(key){ try{ return JSON.parse(localStorage.getItem(key) || '[]'); } catch(e){ return []; } }
function save(key, data){ localStorage.setItem(key, JSON.stringify(data)); }

/* ========= App Class ========= */
class GambiaBizLedger {
  constructor(){
    this.transactions = load(STORAGE_KEYS.TX);
    this.invoices = load(STORAGE_KEYS.INV);
    this.chart = null;
    this.init();
  }

  init(){
    // Tabs
    qsa('.tab-btn').forEach(btn => btn.addEventListener('click', (ev) => {
      this.switchTab(ev.currentTarget.dataset.tab);
    }));

    // Buttons opening modals
    ['addTxBtn','addTxBtn2'].forEach(id => { if(el(id)) el(id).addEventListener('click', ()=> openModal('transactionModal')); });
    ['createInvBtn','createInvBtn2'].forEach(id => { if(el(id)) el(id).addEventListener('click', ()=> openModal('invoiceModal')); });

    // Modal close buttons (data-close)
    qsa('[data-close]').forEach(btn => btn.addEventListener('click', (e) => {
      const modal = e.currentTarget.closest('.modal');
      if(modal) closeModal(modal.id);
    }));

    // Click outside to close modal
    qsa('.modal').forEach(modalEl => {
      modalEl.addEventListener('click', (ev) => {
        if(ev.target === modalEl) closeModal(modalEl.id);
      });
    });

    // Forms
    el('transactionForm').addEventListener('submit', (e)=>{ e.preventDefault(); this.addTransaction(); });
    el('invoiceForm').addEventListener('submit', (e)=>{ e.preventDefault(); this.createInvoice(); });

    // Filters
    el('typeFilter').addEventListener('change', ()=> this.displayTransactions());
    el('dateFilter').addEventListener('change', ()=> this.displayTransactions());

    // Invoice item add
    el('addInvoiceItemBtn').addEventListener('click', ()=> this.addInvoiceItemUI());

    // Reports buttons
    el('aiSummaryBtn').addEventListener('click', ()=> this.generateFinancialSummary());
    el('exportBtn').addEventListener('click', ()=> this.exportData());

    // Initialize UI
    this.updateUI();
  }

  switchTab(tabName){
    qsa('.tab-btn').forEach(b => b.classList.toggle('active', b.dataset.tab === tabName));
    qsa('.tab-panel').forEach(p => {
      if(p.id === tabName){ p.style.display = ''; p.setAttribute('aria-hidden','false'); }
      else { p.style.display = 'none'; p.setAttribute('aria-hidden','true'); }
    });
    // If switching to reports update chart
    if(tabName === 'reports') this.updateChart();
  }

  addTransaction(){
    const type = el('transactionType').value;
    const amount = parseFloat(el('amount').value || 0);
    const description = el('description').value.trim();
    const date = el('transactionDate').value || (new Date()).toISOString().split('T')[0];

    if(!type || !description || !amount || isNaN(amount)){
      notify('Please fill all transaction fields correctly');
      return;
    }

    const tx = { id: 'TX-'+Date.now().toString().slice(-6), type, amount, description, date, createdAt: new Date().toISOString() };
    this.transactions.unshift(tx);
    save(STORAGE_KEYS.TX, this.transactions);

    closeModal('transactionModal');
    el('transactionForm').reset();
    notify('Transaction added âœ…');
    this.updateUI();
  }

  createInvoice(){
    const name = el('customerName').value.trim();
    const phone = el('customerPhone').value.trim();
    const itemNodes = qsa('.invoice-item', el('invoiceItems'));
    const items = [];
    for(const node of itemNodes){
      const desc = qs('.item-desc', node).value.trim();
      const qty = parseInt(qs('.item-qty', node).value || '0', 10);
      const price = parseFloat(qs('.item-price', node).value || '0');
      if(!desc || !qty || isNaN(qty) || !price || isNaN(price)){
        // skip invalid item
        continue;
      }
      items.push({ description: desc, quantity: qty, price, total: qty * price });
    }

    if(!name || items.length === 0){
      notify('Please provide customer name and at least one valid item');
      return;
    }

    const total = items.reduce((s,i)=>s+i.total,0);
    const invoice = { id: 'INV-'+Date.now().toString().slice(-6), customerName:name, customerPhone:phone, items, total, date: (new Date()).toISOString().split('T')[0], createdAt: new Date().toISOString() };
    this.invoices.unshift(invoice);
    save(STORAGE_KEYS.INV, this.invoices);

    closeModal('invoiceModal');
    el('invoiceForm').reset();
    // clear extra invoice item UI (leave single blank)
    el('invoiceItems').innerHTML = '';
    this.addInvoiceItemUI();

    notify('Invoice created ðŸ§¾');
    this.updateUI();
    // Optionally open a printable invoice â€” user can add this later
  }

  addInvoiceItemUI(){
    const container = el('invoiceItems');
    const wrapper = document.createElement('div');
    wrapper.className = 'invoice-item';
    wrapper.style.display = 'flex';
    wrapper.style.gap = '8px';
    wrapper.style.marginBottom = '8px';

    const desc = document.createElement('input'); desc.type='text'; desc.className='item-desc'; desc.placeholder='Item description'; desc.required=true; desc.style.flex='2';
    const qty = document.createElement('input'); qty.type='number'; qty.className='item-qty'; qty.placeholder='Qty'; qty.min='1'; qty.required=true; qty.style.flex='1';
    const price = document.createElement('input'); price.type='number'; price.className='item-price'; price.placeholder='Price'; price.step='0.01'; price.required=true; price.style.flex='1';
    wrapper.appendChild(desc); wrapper.appendChild(qty); wrapper.appendChild(price);
    container.appendChild(wrapper);
    // Focus new desc
    desc.focus();
  }

  updateUI(){
    this.updateSummaryCards();
    this.displayRecentTransactions();
    this.displayTransactions();
    this.displayInvoices();
    // update chart if visible
    if(this.chart) this.updateChart();
  }

  updateSummaryCards(){
    const now = new Date();
    const month = now.getMonth();
    const year = now.getFullYear();
    const monthly = this.transactions.filter(t => {
      const d = new Date(t.date);
      return d.getMonth() === month && d.getFullYear() === year;
    });

    const income = monthly.filter(t => t.type === 'sale').reduce((s,t)=>s+t.amount,0);
    const expenses = monthly.filter(t => t.type === 'expense').reduce((s,t)=>s+t.amount,0);
    const balance = income - expenses;

    el('totalBalance').textContent = `GMD ${balance.toFixed(2)}`;
    el('monthlyIncome').textContent = `GMD ${income.toFixed(2)}`;
    el('monthlyExpenses').textContent = `GMD ${expenses.toFixed(2)}`;
  }

  displayRecentTransactions(){
    const container = el('recentTransactions');
    container.innerHTML = '';
    const list = this.transactions.slice(0,6);
    if(list.length === 0){ container.innerHTML = '<div style="color:#666;padding:10px">No transactions yet</div>'; return; }
    for(const t of list){
      const item = document.createElement('div');
      item.className = 'transaction-item';
      item.innerHTML = `
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="font-size:20px">${t.type === 'sale' ? 'ðŸ’°' : 'ðŸ’¸'}</div>
          <div>
            <div class="transaction-desc">${escapeHtml(t.description)}</div>
            <div class="transaction-date">${formatDate(t.date)}</div>
          </div>
        </div>
        <div style="text-align:right">
          <div class="transaction-amount ${t.type === 'sale' ? 'positive' : 'negative'}">GMD ${t.amount.toFixed(2)}</div>
        </div>
      `;
      container.appendChild(item);
    }
  }

  displayTransactions(){
    const container = el('allTransactions');
    const type = el('typeFilter').value;
    const date = el('dateFilter').value;
    let filtered = this.transactions.slice();
    if(type !== 'all') filtered = filtered.filter(t => t.type === type);
    if(date) filtered = filtered.filter(t => t.date === date);

    container.innerHTML = '';
    if(filtered.length === 0){ container.innerHTML = '<div style="color:#666;padding:10px">No transactions match the filters</div>'; return; }
    for(const t of filtered){
      const row = document.createElement('div');
      row.className = 'transaction-item';
      row.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px;">
          <div style="font-size:18px">${t.type === 'sale' ? 'ðŸ’°' : 'ðŸ’¸'}</div>
          <div>
            <div class="transaction-desc">${escapeHtml(t.description)}</div>
            <div class="transaction-date">${formatDate(t.date)}</div>
          </div>
        </div>
        <div style="text-align:right">
          <div class="transaction-amount ${t.type === 'sale' ? 'positive' : 'negative'}">GMD ${t.amount.toFixed(2)}</div>
        </div>
      `;
      container.appendChild(row);
    }
  }

  displayInvoices(){
    const container = el('invoicesList');
    container.innerHTML = '';
    if(this.invoices.length === 0){ container.innerHTML = '<div style="color:#666;padding:10px">No invoices yet</div>'; return; }
    for(const inv of this.invoices){
      const row = document.createElement('div');
      row.className = 'transaction-item';
      row.innerHTML = `
        <div>
          <div style="font-weight:700">${escapeHtml(inv.id)}</div>
          <div style="color:#444">${escapeHtml(inv.customerName)} ${inv.customerPhone ? 'â€¢ ' + escapeHtml(inv.customerPhone) : ''}</div>
          <div class="transaction-date">${formatDate(inv.date)}</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:700">GMD ${inv.total.toFixed(2)}</div>
        </div>
      `;
      container.appendChild(row);
    }
  }

  updateChart(){
    const canvas = el('financeChart');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');

    // compute last 7 days
    const days = [];
    for(let i=6;i>=0;i--){
      const d = new Date(); d.setDate(d.getDate() - i);
      days.push(d.toISOString().split('T')[0]);
    }

    const incomeData = days.map(day => this.transactions.filter(t => t.date === day && t.type === 'sale').reduce((s,t)=>s+t.amount,0));
    const expenseData = days.map(day => this.transactions.filter(t => t.date === day && t.type === 'expense').reduce((s,t)=>s+t.amount,0));

    if(this.chart) this.chart.destroy();
    this.chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: days.map(d => shortDate(d)),
        datasets: [
          { label: 'Income', data: incomeData, borderColor: '#d4af37', backgroundColor: 'rgba(212,175,55,0.12)', tension: 0.3, pointRadius:3 },
          { label: 'Expenses', data: expenseData, borderColor: '#9e9e9e', backgroundColor: 'rgba(158,158,158,0.08)', tension: 0.3, pointRadius:3 }
        ]
      },
      options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'top'}} }
    });
  }

  generateFinancialSummary(){
    // lightweight, client-side summary (placeholder for real AI)
    const totalIncome = this.transactions.filter(t=>t.type==='sale').reduce((s,t)=>s+t.amount,0);
    const totalExpenses = this.transactions.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);
    const net = totalIncome - totalExpenses;
    const expenseRatio = totalIncome > 0 ? (totalExpenses / totalIncome) * 100 : 0;

    const summaryHtml = `
      <h3>ðŸ“Š Financial Summary</h3>
      <p><strong>Total Income:</strong> GMD ${totalIncome.toFixed(2)}</p>
      <p><strong>Total Expenses:</strong> GMD ${totalExpenses.toFixed(2)}</p>
      <p><strong>Net Profit:</strong> GMD ${net.toFixed(2)}</p>
      <p><strong>Expense Ratio:</strong> ${expenseRatio.toFixed(1)}%</p>
      <p><strong>Recommendation:</strong> ${this._recommendation(net, expenseRatio)}</p>
    `;
    el('aiSummary').innerHTML = summaryHtml;
  }

  _recommendation(net, ratio){
    if(net < 0) return 'Operating at a loss â€” cut non-essential expenses and focus on sales conversion.';
    if(ratio > 70) return 'High expenses relative to income â€” review suppliers and overheads.';
    if(ratio < 30) return 'Good cost control â€” consider reinvesting in growth.';
    return 'Healthy position â€” maintain strategies and monitor cashflow.';
  }

  exportData(){
    const payload = { transactions:this.transactions, invoices:this.invoices, exportedAt: new Date().toISOString() };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `gambiabiz-export-${(new Date()).toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
    notify('Exported data âœ…');
  }
}

/* ========= Helpers ========= */
function openModal(id){ const m = el(id); if(!m) return; m.classList.add('open'); m.setAttribute('aria-hidden','false'); }
function closeModal(id){ const m = el(id); if(!m) return; m.classList.remove('open'); m.setAttribute('aria-hidden','true'); }
function notify(msg, ms = 2800){ const n = el('notification'); n.textContent = msg; n.style.display = 'block'; setTimeout(()=> n.style.display = 'none', ms); }
function formatDate(s){ try { const d = new Date(s); return d.toLocaleDateString(); } catch(e){ return s; } }
function shortDate(iso){ const d = new Date(iso); return `${d.getMonth()+1}/${d.getDate()}`; }
function escapeHtml(str){ return String(str).replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];}); }

/* ========= Bootstrap App ========= */
const app = new GambiaBizLedger();

// wire modal openers that were created inline (safer than relying on HTML onclick)
el('addTxBtn')?.addEventListener('click', ()=> openModal('transactionModal'));
el('addTxBtn2')?.addEventListener('click', ()=> openModal('transactionModal'));
el('createInvBtn')?.addEventListener('click', ()=> openModal('invoiceModal'));
el('createInvBtn2')?.addEventListener('click', ()=> openModal('invoiceModal'));

// ensure at least one invoice item exists
if(qsa('.invoice-item', el('invoiceItems')).length === 0){
  app.addInvoiceItemUI();
}

// Expose a couple of convenience global functions (still safe)
window.showModal = openModal;
window.closeModal = closeModal;
window.addInvoiceItem = () => app.addInvoiceItemUI();
window.generateFinancialSummary = () => app.generateFinancialSummary();
window.exportData = () => app.exportData();

/* Initialize chart size handling after a short delay to ensure canvas sizing */
setTimeout(()=> { if(document.querySelector('.tab-btn.active').dataset.tab === 'reports') app.updateChart(); }, 200);
</script>
</body>
</html>