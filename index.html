<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GambiaBiz Ledger - Smart Financial Assistant</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <header>
            <h1>üá¨üá≤ GambiaBiz Ledger</h1>
            <p>Smart Financial Assistant for MSMEs</p>
        </header>

        <div class="connection-status" id="connectionStatus">
            <span class="offline">üî¥ Offline Mode</span>
            <span class="online">üü¢ Online</span>
        </div>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
            <button class="tab-btn" data-tab="transactions">Transactions</button>
            <button class="tab-btn" data-tab="invoices">Invoices</button>
            <button class="tab-btn" data-tab="reports">Reports</button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="summary-cards">
                <div class="card">
                    <h3>Total Balance</h3>
                    <p class="amount" id="totalBalance">GMD 0.00</p>
                </div>
                <div class="card">
                    <h3>This Month</h3>
                    <p class="amount positive" id="monthlyIncome">GMD 0.00</p>
                </div>
                <div class="card">
                    <h3>Expenses</h3>
                    <p class="amount negative" id="monthlyExpenses">GMD 0.00</p>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn-primary" onclick="showModal('transactionModal')">
                    ‚ûï Add Transaction
                </button>
                <button class="btn-secondary" onclick="showModal('invoiceModal')">
                    üßæ Create Invoice
                </button>
            </div>

            <div class="recent-activity">
                <h3>Recent Activity</h3>
                <div id="recentTransactions"></div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab-content">
            <div class="section-header">
                <h2>All Transactions</h2>
                <button class="btn-primary" onclick="showModal('transactionModal')">
                    Add Transaction
                </button>
            </div>
            <div class="filters">
                <select id="typeFilter">
                    <option value="all">All Types</option>
                    <option value="sale">Sales</option>
                    <option value="expense">Expenses</option>
                </select>
                <input type="date" id="dateFilter">
            </div>
            <div id="allTransactions"></div>
        </div>

        <!-- Invoices Tab -->
        <div id="invoices" class="tab-content">
            <div class="section-header">
                <h2>Invoices</h2>
                <button class="btn-primary" onclick="showModal('invoiceModal')">
                    Create Invoice
                </button>
            </div>
            <div id="invoicesList"></div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>Financial Reports</h2>
            <div class="report-actions">
                <button class="btn-secondary" onclick="generateFinancialSummary()">
                    üìä Generate AI Summary
                </button>
                <button class="btn-secondary" onclick="exportData()">
                    üì§ Export Data
                </button>
            </div>
            <div id="aiSummary" class="ai-summary"></div>
            <div class="charts">
                <canvas id="financeChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('transactionModal')">&times;</span>
            <h3>Add Transaction</h3>
            <form id="transactionForm">
                <select id="transactionType" required>
                    <option value="">Select Type</option>
                    <option value="sale">Sale</option>
                    <option value="expense">Expense</option>
                </select>
                <input type="number" id="amount" placeholder="Amount (GMD)" required step="0.01">
                <input type="text" id="description" placeholder="Description" required>
                <select id="category">
                    <option value="general">General</option>
                    <option value="goods">Goods Sold</option>
                    <option value="services">Services</option>
                    <option value="supplies">Supplies</option>
                    <option value="utilities">Utilities</option>
                    <option value="rent">Rent</option>
                </select>
                <input type="date" id="transactionDate" required>
                <div class="form-actions">
                    <button type="button" onclick="closeModal('transactionModal')">Cancel</button>
                    <button type="submit">Save Transaction</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('invoiceModal')">&times;</span>
            <h3>Create Invoice</h3>
            <form id="invoiceForm">
                <input type="text" id="customerName" placeholder="Customer Name" required>
                <input type="text" id="customerPhone" placeholder="Customer Phone">
                <div id="invoiceItems">
                    <div class="invoice-item">
                        <input type="text" placeholder="Item description" class="item-desc" required>
                        <input type="number" placeholder="Quantity" class="item-qty" required min="1">
                        <input type="number" placeholder="Price (GMD)" class="item-price" required step="0.01">
                    </div>
                </div>
                <button type="button" onclick="addInvoiceItem()">‚ûï Add Item</button>
                <div class="form-actions">
                    <button type="button" onclick="closeModal('invoiceModal')">Cancel</button>
                    <button type="submit">Generate Invoice</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sync Notification -->
    <div id="syncNotification" class="notification">
        <span id="syncMessage"></span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
</body>
</html>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f5f5f5;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background: white;
    min-height: 100vh;
}

header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #2E8B57;
}

header h1 {
    color: #2E8B57;
    font-size: 2.5em;
    margin-bottom: 5px;
}

.connection-status {
    text-align: center;
    margin-bottom: 20px;
    font-weight: bold;
}

.connection-status .online {
    color: #2E8B57;
    display: none;
}

.connection-status .offline {
    color: #dc3545;
    display: none;
}

.connection-status.online .online {
    display: block;
}

.connection-status.offline .offline {
    display: block;
}

.tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 1px solid #ddd;
}

.tab-btn {
    flex: 1;
    padding: 12px;
    background: none;
    border: none;
    cursor: pointer;
    border-bottom: 3px solid transparent;
}

.tab-btn.active {
    border-bottom-color: #2E8B57;
    color: #2E8B57;
    font-weight: bold;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
}

.card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
}

.card h3 {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 10px;
}

.amount {
    font-size: 1.5em;
    font-weight: bold;
}

.amount.positive {
    color: #2E8B57;
}

.amount.negative {
    color: #dc3545;
}

.quick-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
}

.btn-primary, .btn-secondary {
    flex: 1;
    padding: 15px;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    cursor: pointer;
    transition: background-color 0.3s;
}

.btn-primary {
    background: #2E8B57;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-primary:hover {
    background: #236b47;
}

.btn-secondary:hover {
    background: #545b62;
}

.recent-activity, .section-header {
    margin-bottom: 20px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.filters {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.filters select, .filters input {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

.transaction-item, .invoice-item {
    background: white;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    box-shadow: 0 1px 5px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.transaction-amount.positive {
    color: #2E8B57;
    font-weight: bold;
}

.transaction-amount.negative {
    color: #dc3545;
    font-weight: bold;
}

.transaction-desc {
    flex: 1;
    margin: 0 15px;
}

.transaction-date {
    color: #666;
    font-size: 0.9em;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 30px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    position: relative;
}

.close {
    position: absolute;
    right: 15px;
    top: 15px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.modal h3 {
    margin-bottom: 20px;
    color: #2E8B57;
}

form select, form input {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1em;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.form-actions button {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.form-actions button[type="submit"] {
    background: #2E8B57;
    color: white;
}

.invoice-item {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

.invoice-item input {
    margin-bottom: 0;
}

.item-desc {
    flex: 2;
}

.item-qty, .item-price {
    flex: 1;
}

.notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 15px 20px;
    background: #2E8B57;
    color: white;
    border-radius: 5px;
    display: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.ai-summary {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    border-left: 4px solid #2E8B57;
}

.charts {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

@media (max-width: 600px) {
    .container {
        padding: 10px;
    }
    
    .summary-cards {
        grid-template-columns: 1fr;
    }
    
    .quick-actions {
        flex-direction: column;
    }
    
    .section-header {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
    }
}
class GambiaBizLedger {
    constructor() {
        this.transactions = this.loadData('transactions') || [];
        this.invoices = this.loadData('invoices') || [];
        this.init();
    }

    init() {
        this.setupEventListeners();
        this.updateUI();
        this.setupOfflineDetection();
        this.registerServiceWorker();
        this.setupSync();
    }

    setupEventListeners() {
        // Tab navigation
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.switchTab(e.target.dataset.tab);
            });
        });

        // Forms
        document.getElementById('transactionForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.addTransaction();
        });

        document.getElementById('invoiceForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.createInvoice();
        });

        // Filters
        document.getElementById('typeFilter').addEventListener('change', () => {
            this.filterTransactions();
        });

        document.getElementById('dateFilter').addEventListener('change', () => {
            this.filterTransactions();
        });
    }

    switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(tabName).classList.add('active');

        // Refresh specific tab content
        if (tabName === 'transactions') {
            this.displayTransactions();
        } else if (tabName === 'invoices') {
            this.displayInvoices();
        } else if (tabName === 'reports') {
            this.updateCharts();
        }
    }

    addTransaction() {
        const form = document.getElementById('transactionForm');
        const formData = new FormData(form);
        
        const transaction = {
            id: Date.now().toString(),
            type: document.getElementById('transactionType').value,
            amount: parseFloat(document.getElementById('amount').value),
            description: document.getElementById('description').value,
            category: document.getElementById('category').value,
            date: document.getElementById('transactionDate').value || new Date().toISOString().split('T')[0],
            timestamp: new Date().toISOString()
        };

        this.transactions.unshift(transaction);
        this.saveData('transactions', this.transactions);
        this.updateUI();
        this.closeModal('transactionModal');
        form.reset();
        
        this.showNotification('Transaction added successfully!');
    }

    createInvoice() {
        const customerName = document.getElementById('customerName').value;
        const customerPhone = document.getElementById('customerPhone').value;
        
        const items = [];
        document.querySelectorAll('.invoice-item').forEach(itemEl => {
            const desc = itemEl.querySelector('.item-desc').value;
            const qty = parseInt(itemEl.querySelector('.item-qty').value);
            const price = parseFloat(itemEl.querySelector('.item-price').value);
            
            if (desc && qty && price) {
                items.push({
                    description: desc,
                    quantity: qty,
                    price: price,
                    total: qty * price
                });
            }
        });

        const total = items.reduce((sum, item) => sum + item.total, 0);

        const invoice = {
            id: 'INV-' + Date.now().toString().slice(-6),
            customerName,
            customerPhone,
            items,
            total,
            date: new Date().toISOString().split('T')[0],
            status: 'pending',
            timestamp: new Date().toISOString()
        };

        this.invoices.unshift(invoice);
        this.saveData('invoices', this.invoices);
        this.displayInvoices();
        this.closeModal('invoiceModal');
        document.getElementById('invoiceForm').reset();
        
        this.showNotification('Invoice created successfully!');
        this.generateInvoicePDF(invoice);
    }

    generateInvoicePDF(invoice) {
        // Simple PDF generation using window.print()
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>Invoice ${invoice.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .customer-info { margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
                        th { background: #f5f5f5; }
                        .total { font-weight: bold; font-size: 1.2em; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>INVOICE</h1>
                        <p>GambiaBiz Ledger</p>
                        <p>Invoice: ${invoice.id}</p>
                        <p>Date: ${invoice.date}</p>
                    </div>
                    
                    <div class="customer-info">
                        <h3>Bill To:</h3>
                        <p>${invoice.customerName}</p>
                        <p>${invoice.customerPhone}</p>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Quantity</th>
                                <th>Price (GMD)</th>
                                <th>Total (GMD)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${invoice.items.map(item => `
                                <tr>
                                    <td>${item.description}</td>
                                    <td>${item.quantity}</td>
                                    <td>${item.price.toFixed(2)}</td>
                                    <td>${item.total.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" style="text-align: right;"><strong>Total:</strong></td>
                                <td class="total">GMD ${invoice.total.toFixed(2)}</td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div style="margin-top: 30px;">
                        <p><strong>Thank you for your business!</strong></p>
                        <p>Please make payment within 7 days.</p>
                    </div>
                </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }

    updateUI() {
        this.updateSummaryCards();
        this.displayRecentTransactions();
        this.displayTransactions();
        this.updateCharts();
    }

    updateSummaryCards() {
        const now = new Date();
        const thisMonth = now.getMonth();
        const thisYear = now.getFullYear();

        const monthlyTransactions = this.transactions.filter(t => {
            const transactionDate = new Date(t.date);
            return transactionDate.getMonth() === thisMonth && 
                   transactionDate.getFullYear() === thisYear;
        });

        const income = monthlyTransactions
            .filter(t => t.type === 'sale')
            .reduce((sum, t) => sum + t.amount, 0);

        const expenses = monthlyTransactions
            .filter(t => t.type === 'expense')
            .reduce((sum, t) => sum + t.amount, 0);

        const balance = income - expenses;

        document.getElementById('totalBalance').textContent = `GMD ${balance.toFixed(2)}`;
        document.getElementById('monthlyIncome').textContent = `GMD ${income.toFixed(2)}`;
        document.getElementById('monthlyExpenses').textContent = `GMD ${expenses.toFixed(2)}`;
    }

    displayRecentTransactions() {
        const container = document.getElementById('recentTransactions');
        const recent = this.transactions.slice(0, 5);
        
        container.innerHTML = recent.map(transaction => `
            <div class="transaction-item">
                <span class="transaction-type">${transaction.type === 'sale' ? 'üí∞ Sale' : 'üí∏ Expense'}</span>
                <span class="transaction-desc">${transaction.description}</span>
                <span class="transaction-amount ${transaction.type === 'sale' ? 'positive' : 'negative'}">
                    ${transaction.type === 'sale' ? '+' : '-'}GMD ${transaction.amount.toFixed(2)}
                </span>
                <span class="transaction-date">${this.formatDate(transaction.date)}</span>
            </div>
        `).join('');
    }

    displayTransactions() {
        const container = document.getElementById('allTransactions');
        const typeFilter = document.getElementById('typeFilter').value;
        const dateFilter = document.getElementById('dateFilter').value;

        let filtered = this.transactions;

        if (typeFilter !== 'all') {
            filtered = filtered.filter(t => t.type === typeFilter);
        }

        if (dateFilter) {
            filtered = filtered.filter(t => t.date === dateFilter);
        }

        container.innerHTML = filtered.map(transaction => `
            <div class="transaction-item">
                <span class="transaction-type">${transaction.type === 'sale' ? 'üí∞' : 'üí∏'}</span>
                <span class="transaction-desc">${transaction.description}</span>
                <span class="transaction-amount ${transaction.type === 'sale' ? 'positive' : 'negative'}">
                    GMD ${transaction.amount.toFixed(2)}
                </span>
                <span class="transaction-date">${this.formatDate(transaction.date)}</span>
            </div>
        `).join('');
    }

    displayInvoices() {
        const container = document.getElementById('invoicesList');
        
        container.innerHTML = this.invoices.map(invoice => `
            <div class="transaction-item">
                <div>
                    <strong>${invoice.id}</strong>
                    <div>${invoice.customerName} ‚Ä¢ ${invoice.customerPhone || 'No phone'}</div>
                    <small>${this.formatDate(invoice.date)} ‚Ä¢ Status: ${invoice.status}</small>
                </div>
                <div>
                    <strong>GMD ${invoice.total.toFixed(2)}</strong>
                    <button onclick="app.printInvoice('${invoice.id}')" style="margin-left: 10px;">Print</button>
                </div>
            </div>
        `).join('');
    }

    printInvoice(invoiceId) {
        const invoice = this.invoices.find(inv => inv.id === invoiceId);
        if (invoice) {
            this.generateInvoicePDF(invoice);
        }
    }

    filterTransactions() {
        this.displayTransactions();
    }

    updateCharts() {
        const ctx = document.getElementById('financeChart').getContext('2d');
        
        // Group transactions by date for the last 7 days
        const last7Days = [...Array(7)].map((_, i) => {
            const d = new Date();
            d.setDate(d.getDate() - i);
            return d.toISOString().split('T')[0];
        }).reverse();

        const incomeData = last7Days.map(date => 
            this.transactions
                .filter(t => t.date === date && t.type === 'sale')
                .reduce((sum, t) => sum + t.amount, 0)
        );

        const expenseData = last7Days.map(date => 
            this.transactions
                .filter(t => t.date === date && t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0)
        );

        if (window.financeChart) {
            window.financeChart.destroy();
        }

        window.financeChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: last7Days.map(date => this.formatDate(date)),
                datasets: [
                    {
                        label: 'Income',
                        data: incomeData,
                        borderColor: '#2E8B57',
                        backgroundColor: 'rgba(46, 139, 87, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Expenses',
                        data: expenseData,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: '7-Day Financial Trend'
                    }
                }
            }
        });
    }

    async generateFinancialSummary() {
        const summaryElement = document.getElementById('aiSummary');
        summaryElement.innerHTML = '<p>ü§î Analyzing your financial data...</p>';

        // Simulate AI analysis - in a real app, this would call an API
        setTimeout(() => {
            const income = this.transactions
                .filter(t => t.type === 'sale')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expenses = this.transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const profit = income - expenses;
            const expenseRatio = income > 0 ? (expenses / income) * 100 : 0;

            const summary = `
                <h3>üìä AI Financial Summary</h3>
                <p><strong>Total Income:</strong> GMD ${income.toFixed(2)}</p>
                <p><strong>Total Expenses:</strong> GMD ${expenses.toFixed(2)}</p>
                <p><strong>Net Profit:</strong> GMD ${profit.toFixed(2)}</p>
                <p><strong>Expense Ratio:</strong> ${expenseRatio.toFixed(1)}% of income</p>
                <p><strong>Recommendation:</strong> ${this.generateRecommendation(profit, expenseRatio)}</p>
            `;
            
            summaryElement.innerHTML = summary;
        }, 2000);
    }

    generateRecommendation(profit, expenseRatio) {
        if (profit < 0) {
            return "Your business is operating at a loss. Consider reducing expenses and increasing sales efforts.";
        } else if (expenseRatio > 70) {
            return "Your expenses are high relative to income. Look for ways to optimize operational costs.";
        } else if (expenseRatio < 30) {
            return "Good cost control! Consider investing in growth opportunities.";
        } else {
            return "Healthy financial position. Maintain current strategies while exploring efficiency improvements.";
        }
    }

    exportData() {
        const data = {
            transactions: this.transactions,
            invoices: this.invoices,
            exportDate: new Date().toISOString()
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `gambiabiz-ledger-export-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        this.showNotification('Data exported successfully!');
    }

    setupOfflineDetection() {
        const statusElement = document.getElementById('connectionStatus');
        
        const updateStatus = () => {
            if (navigator.onLine) {
                statusElement.classList.remove('offline');
                statusElement.classList.add('online');
            } else {
                statusElement.classList.remove('online');
                statusElement.classList.add('offline');
            }
        };

        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);
        updateStatus();
    }

    setupSync() {
        // Simulate sync with server when online
        window.addEventListener('online', () => {
            this.syncWithServer();
        });
    }

    async syncWithServer() {
        this.showNotification('Syncing data with server...');
        
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        this.showNotification('Data synchronized successfully!');
    }

    registerServiceWorker() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(() => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed:', err));
        }
    }

    // Utility methods
    formatDate(dateString) {
        return new Date(dateString).toLocaleDateString('en-GB');
    }

    showModal(modalId) {
        document.getElementById(modalId).style.display = 'block';
    }

    closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    showNotification(message) {
        const notification = document.getElementById('syncNotification');
        const messageElement = document.getElementById('syncMessage');
        
        messageElement.textContent = message;
        notification.style.display = 'block';
        
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }

    loadData(key) {
        const data = localStorage.getItem(`gambiabiz_${key}`);
        return data ? JSON.parse(data) : null;
    }

    saveData(key, data) {
        localStorage.setItem(`gambiabiz_${key}`, JSON.stringify(data));
    }

    addInvoiceItem() {
        const container = document.getElementById('invoiceItems');
        const newItem = document.createElement('div');
        newItem.className = 'invoice-item';
        newItem.innerHTML = `
            <input type="text" placeholder="Item description" class="item-desc" required>
            <input type="number" placeholder="Quantity" class="item-qty" required min="1">
            <input type="number" placeholder="Price (GMD)" class="item-price" required step="0.01">
        `;
        container.appendChild(newItem);
    }
}

// Service Worker for offline functionality
const serviceWorkerCode = `
self.addEventListener('install', (event) => {
    self.skipWaiting();
});

self.addEventListener('fetch', (event) => {
    event.respondWith(
        caches.match(event.request).then(response => {
            return response || fetch(event.request);
        })
    );
});
`;

// Create and download service worker file
function createServiceWorker() {
    const blob = new Blob([serviceWorkerCode], { type: 'application/javascript' });
    return URL.createObjectURL(blob);
}

// Initialize app when DOM is loaded
let app;
document.addEventListener('DOMContentLoaded', () => {
    app = new GambiaBizLedger();
    
    // Close modal when clicking outside
    window.addEventListener('click', (event) => {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
        }
    });
});

// Global functions for HTML onclick handlers
function showModal(modalId) {
    app.showModal(modalId);
}

function closeModal(modalId) {
    app.closeModal(modalId);
}

function addInvoiceItem() {
    app.addInvoiceItem();
}

function generateFinancialSummary() {
    app.generateFinancialSummary();
}

function exportData() {
    app.exportData();
}
const CACHE_NAME = 'gambiabiz-ledger-v1';
const urlsToCache = [
    '/',
    '/index.html',
    '/styles.css',
    '/app.js',
    '/manifest.json'
];

self.addEventListener('install', (event) => {
    event.waitUntil(
        caches.open(CACHE_NAME)
            .then((cache) => cache.addAll(urlsToCache))
    );
});

self.addEventListener('fetch', (event) => {
    event.respondWith(
        caches.match(event.request)
            .then((response) => {
                // Return cached version or fetch from network
                return response || fetch(event.request);
            }
        )
    );
});

self.addEventListener('activate', (event) => {
    event.waitUntil(
        caches.keys().then((cacheNames) => {
            return Promise.all(
                cacheNames.map((cacheName) => {
                    if (cacheName !== CACHE_NAME) {
                        return caches.delete(cacheName);
                    }
                })
            );
        })
    );
});
{
    "name": "GambiaBiz Ledger",
    "short_name": "GambiaBiz",
    "description": "Smart Financial Assistant for Gambian MSMEs",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#ffffff",
    "theme_color": "#2E8B57",
    "icons": [
        {
            "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMyRTg4NTciLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8cGF0aCBkPSJNOCA3VjNNMjAgN1YzTTMgMTBIMjFNNiAxNEg4TTE2IDE0SDE4TTYgMThIOE0xNiAxOEgxOE0xNCAxMEgxMFYyMEgxNFYxMFoiLz4KPC9zdmc+Cjwvc3ZnPgo=",
            "sizes": "192x192",
            "type": "image/svg+xml"
        }
    ]
}
# üá¨üá≤ GambiaBiz Ledger

A smart financial assistant mobile web app for Gambian Small and Medium Enterprises (SMEs).

## Features

- üí∞ **Record Sales & Expenses**: Easy transaction tracking
- üßæ **AI-Powered Invoices**: Generate professional invoices
- üìä **Financial Reports**: Visual charts and AI-generated insights
- üì± **Offline-First**: Works without internet connection
- üîÑ **Auto-Sync**: Syncs data when online
- üí∏ **Payment Tracking**: Monitor pending payments

## Target Users

- üëï Tailors
- üõçÔ∏è Mini-shops
- üíÑ Beauty salons
- üè™ Local stores
- üîß Small service providers

## Technology Stack

- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **Storage**: LocalStorage (offline-first)
- **Charts**: Chart.js for financial visualization
- **PWA**: Service Worker for offline functionality
- **Printing**: Browser print API for invoices

## Quick Start

1. **Download all files** to a folder
2. **Open `index.html`** in a web browser
3. **Start adding transactions** and creating invoices

No installation or server required!

## Browser Support

- Chrome/Edge 60+
- Firefox 55+
- opera
- google
- Phenix 
- Safari 11+
- Mobile browsers (iOS Safari, Chrome Mobile)

## File Structure

### 4. LICENSE File
Create a `LICENSE` file with MIT license:
```text
MIT License

Copyright (c) 2024 GambiaBiz Ledger

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
